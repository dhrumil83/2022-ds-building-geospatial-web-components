import { t, k as r, a as s, e as e$1, d as d$1, i } from './intl-f9bcf179.js';
import g from './FeatureSet-4fb958ac.js';
import D from './FeatureLayerView2D-7b0c76af.js';
import { e } from './util-487bac14.js';
import './vec2f32-a88eee2e.js';
import './JSONSupport-add604e3.js';
import './Field-c0076075.js';
import './fieldType-064db2a2.js';
import './reactiveUtils-7b2ef76d.js';
import './watchUtils-47c42485.js';
import './Container-1e7079ff.js';
import './esri-ds2022-map-viewer-35c68a1d.js';
import './index-5d892dab.js';
import './CollectionFlattener-bcf03412.js';
import './HandleOwner-8815c4dd.js';
import './Handles-c08f164d.js';
import './TablesMixin-ae9b8027.js';
import './MultiOriginJSONSupport-9580fd5e.js';
import './iteratorUtils-07a71e8c.js';
import './workers-b2f67d28.js';
import './accessibleHandler-756590a8.js';
import './uuid-917a1a17.js';
import './aliasOf-93c38510.js';
import './executeQueryJSON-99aa27d5.js';
import './utils-8e500178.js';
import './scaleUtils-88e9eb11.js';
import './floorFilterUtils-a09da11b.js';
import './query-f9bc0945.js';
import './normalizeUtils-4a0b810f.js';
import './arcgisLayerUrl-44d1a3ba.js';
import './pbfQueryUtils-cdfd4767.js';
import './pbf-82f66092.js';
import './OptimizedFeature-b2ac674d.js';
import './OptimizedFeatureSet-27736f1f.js';
import './queryZScale-5052a726.js';
import './zscale-41674b48.js';
import './Query-689827fc.js';
import './TimeExtent-c4789fb1.js';
import './TopFeaturesQuery-1ab1fe83.js';
import './widget-285e2192.js';
import './QueryTask-b0a64993.js';
import './featureConversionUtils-a3d8ec70.js';
import './Task-634f7f0c.js';
import './languageUtils-884f50f9.js';
import './_commonjsHelpers-321aa363.js';
import './number-18a63da8.js';
import './FeatureLayer-d0cffc77.js';
import './UniqueValueRenderer-e0928c5a.js';
import './VisualVariablesMixin-8a22cf6b.js';
import './colorRamps-76de530b.js';
import './diffUtils-090e743c.js';
import './styleUtils-4a488c71.js';
import './DictionaryRenderer-3a040527.js';
import './LRUCache-257bc9a6.js';
import './MemCache-cd2cb7cb.js';
import './jsonUtils-d380cab0.js';
import './HeightModelInfo-d5d3aa1e.js';
import './APIKeyMixin-8575f837.js';
import './ArcGISService-7e7b6abe.js';
import './BlendLayer-324633cc.js';
import './mat4-ae511675.js';
import './_commonjsHelpers-020ca939.js';
import './CustomParametersMixin-a86b0825.js';
import './labelingInfo-25767b21.js';
import './FeatureReductionCluster-71a4b0f9.js';
import './commonProperties-dc6e2688.js';
import './OperationalLayer-4ec71ac3.js';
import './OrderedLayer-c71463ea.js';
import './PortalLayer-1931d936.js';
import './RefreshableLayer-1f637573.js';
import './ScaleRangeLayer-e13c0aef.js';
import './TemporalLayer-53bb7671.js';
import './TimeInfo-eeca5f4b.js';
import './FeatureType-b8b87e07.js';
import './fieldProperties-49d5cbad.js';
import './FieldsIndex-a1139706.js';
import './LayerFloorInfo-b956bff1.js';
import './styleUtils-d505ace0.js';
import './popupUtils-74d35ca3.js';
import './utils-0c74ca00.js';
import './ItemCache-f1121cd2.js';
import './utils-86b5682d.js';
import './TileStore-07b000ac.js';
import './TileKey-a7cf75b8.js';
import './quickselect-ccfd8cff.js';
import './TileInfo-70467c72.js';
import './GraphicsCollection-29817947.js';
import './Scheduler-69870efa.js';
import './projection-60b2cc57.js';
import './unitBezier-0f2e6a45.js';
import './vec2f64-503345b4.js';
import './mat3-5a3bab08.js';
import './TileStrategy-94fc5f8a.js';
import './screenshotUtils-9bdc6cab.js';
import './capabilities-7c6ba5e3.js';
import './drapedUtils-25e8ce6c.js';
import './definitions-08701efa.js';
import './LayerView-93fcaba5.js';
import './schemaUtils-008b3be6.js';
import './Utils-03a18796.js';
import './number-237bc27c.js';
import './Texture-2c125101.js';
import './MaterialKey-80102021.js';
import './visualVariablesUtils-54c52a4e.js';
import './CIMSymbolHelper-18d731f4.js';
import './shapingUtils-2219035b.js';
import './Rect-988189d5.js';
import './GeometryUtils-93aa6536.js';
import './cimSymbolUtils-7737b0ac.js';
import './cimAnalyzer-65b5b691.js';
import './quantizationUtils-9e335e8b.js';
import './devEnvironmentUtils-c5b59f3c.js';
import './clusterUtils-65e289cf.js';
import './MD5-6027098a.js';
import './popupUtils-21dcd6b5.js';
import './RefreshableLayerView-74712ecf.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function l(e,t$1){if(t(e)&&t(t$1))return null;const s={};return r(t$1)&&(s.geometry=t$1.toJSON()),r(e)&&(s.where=e),s}let p=class extends D{constructor(){super(...arguments),this._enabledDataReceived=!1,this.errorString=null,this.connectionStatus="disconnected";}initialize(){this.handles.add([this.layer.watch("purgeOptions",(()=>this._update()))]);}destroy(){this.connectionStatus="disconnected";}get connectionError(){if(this.errorString)return new s("stream-controller",this.errorString)}on(e,t){"data-received"===e&&(this._enabledDataReceived=!0,this._proxy.enableEvent("data-received",!0));const r=super.on(e,t),o=this;return {remove(){r.remove(),"data-received"===e&&(o._proxy.closed||o.hasEventListener("data-received")||o._proxy.enableEvent("data-received",!1));}}}queryLatestObservations(e,r){if(!(this.layer.timeInfo.endField||this.layer.timeInfo.startField))throw new s("streamlayer-no-timeField","queryLatestObservation can only be used with services that define a TrackIdField");return this._proxy.queryLatestObservations(this._cleanUpQuery(e),r).then((e=>{const t=g.fromJSON(e);return t.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer;})),t}))}_createClientOptions(){return {...super._createClientOptions(),setProperty:e=>{this.set(e.propertyName,e.value);}}}_createTileRendererHash(e){const t=`${JSON.stringify(this.layer.purgeOptions)}.${JSON.stringify(l(this.layer.definitionExpression,this.layer.geometryDefinition))})`;return super._createTileRendererHash(e)+t}async _createServiceOptions(){const e$1=this.layer,{objectIdField:t}=e$1,r=e$1.fields.map((e=>e.toJSON())),o=e(e$1.geometryType),s=e$1.timeInfo&&e$1.timeInfo.toJSON()||null,i=e$1.spatialReference?e$1.spatialReference.toJSON():null;return {type:"stream",fields:r,geometryType:o,objectIdField:t,timeInfo:s,source:this.layer.parsedUrl,serviceFilter:l(this.layer.definitionExpression,this.layer.geometryDefinition),purgeOptions:this.layer.purgeOptions.toJSON(),enableDataReceived:this._enabledDataReceived,spatialReference:i,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,updateInterval:this.layer.updateInterval,customParameters:e$1.customParameters}}};e$1([d$1()],p.prototype,"errorString",void 0),e$1([d$1({readOnly:!0})],p.prototype,"connectionError",null),e$1([d$1()],p.prototype,"connectionStatus",void 0),p=e$1([i("esri.views.2d.layers.StreamLayerView2D")],p);const d=p;

export default d;
